<!DOCTYPE HTML>
<html class="no-js" lang="es-419">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Control de gastos</title>
  <meta name="description" content="Control de gastos, objetivos y más">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="//img.icons8.com/color/32/000000/check.png">

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Arial' Sans-serif;
      margin: 0;
    }
    form {
      padding: 1rem;
    }
    label {
      display: flex;
      flex-direction: column-reverse;
      margin-bottom: 1rem;
    }

    .off {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Control económico</h1>
  <nav>
    <ul>
      <li><span>Adeudos</span></li>
      <li><span>Ahorros</span></li>
      <li><span>Bitácora de gastos</span></li>
      <li><span>Objetivos</span></li>
      <li><span>Tarjetas de crédito</span></li>
    </ul>
  </nav>
  <section>
    <form id="form_register">
      <h2>Registro de egresos</h2>
      <label>
        <input class="" name="amount" id="amount" type="number" step='0.01' min="0.00" autocomplete="off" placeholder="0.00">
        <span>Monto</span>
      </label>
      <label>
        <select class="" name="description" id="description">
          <option value="0">Seleccione una opción</option>
          <option value="1">Internet</option>
          <option value="2">Renta</option>
          <option value="-1">Otro</option>
        </select>
        <span>Descripción</span>
      </label>
      <label>
        <input class="" name="name_new_description" id="name_new_description" type="text" autocomplete="off" data-ui="hidden">
        <span>Nombre</span>
      </label>
      <label>
        <input class="" name="new_description" id="new_description" type="checkbox" autocomplete="off" data-ui="hidden">
        <span>Agregar a lista de opciones de: "Descripción"</span>
      </label>
      <label>
        <select class="" name="ubication" id="ubication">
          <option value="">Seleccione una opción</option>
          <option value="0" data-amount="100">Internet</option>
          <option value="2" data-amount="1200">Renta</option>
          <option value="-1">Otro</option>
        </select>
        <span>Lugar</span>
      </label>
      <label>
        <input class="" name="name_new_ubication" id="name_new_ubication" type="text" autocomplete="off" data-ui="hidden">
        <span>Nombre</span>
      </label>
      <label>
        <input class="" name="new_ubication" id="new_ubication" type="checkbox" autocomplete="off" data-ui="hidden">
        <span>Agregar a lista de opciones de: "Lugar"</span>
      </label>
      <label>
        <select class="" name="way_pay" id="way_pay">
          <option value="">Seleccione una opción</option>
          <option value="">Tarjeta de crédito: Aeromexico</option>
          <option value="">Tarjeta de crédito: Efectivo</option>
          <option value="">Tarjeta de crédito: Free</option>
          <option value="">Tarjeta de crédito: Zero</option>
          <option value="">Cuenta paypal: Aeromexico</option>
          <option value="">Cuenta paypal: Efectivo</option>
          <option value="">Cuenta paypal: Free</option>
          <option value="-1">Otro</option>
        </select>
        <span>Forma de pago</span>
      </label>
      <label>
        <input class="" name="date_purchase" id="date_purchase" type="date" autocomplete="off">
        <span>Fecha de compra</span>
      </label>
      <button class="" type="submit">Aceptar</button>
      <button class="" type="reset">Cancear</button>
    </form>
    <h2>Historial de egresos</h2>
    <table>
      <thead>
        <tr>
          <th>Descripción</th>
          <th>Lugar</th>
          <th>Forma de pago</th>
          <th>Fecha de compra</th>
          <th>Monto</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    _descriptions = {
                      description : [
                                      {
                                        id     : 1,
                                        name   : 'renta',
                                        amount : 2300.00
                                      },
                                      {
                                        id     : 2,
                                        name   : 'internet + teléfono',
                                        amount : 429.00
                                      },
                                    ],
                      create : function() {
                        $html = '<option value="">Seleccione una opción</option>'
                        
                        for (key in this.description) {
                          _value  = this.description[key].id
                          _amount = ' data-amount="' + this.description[key].amount + '"'
                          _label  = this.description[key].name

                          $html += '<option value="' + _value + '"' + _amount + '>' + _label + '</option>'
                        }

                        $html += '<option value="-1">Otro</option>'

                        $description.innerHTML = $html

                        $description.addEventListener('change', function() {
                          optionSelected = this.children[this.options.selectedIndex]

                          if (optionSelected.getAttribute('data-amount') != null)
                            $amount.value = parseFloat(optionSelected.dataset.amount)
                        })
                      },
                    }


    $formRegister = document.querySelector('#form_register')
    $datePurchase = document.querySelector('#date_purchase')
    $description  = document.querySelector('#description')
    $amount       = document.querySelector('#amount')
    
    $$selects     = document.querySelectorAll('select')
    $$resets      = document.querySelectorAll('[type="reset"]')
    $$tags        = document.querySelectorAll('[data-ui]')

    function changeSelect() {
      val    = parseInt(this.value)
      id     = this.id
      
      $check = document.querySelector('#new_' + id)
      $name  = document.querySelector('#name_new_' + id)

      if (val == -1) {
        $check.parentElement.classList.remove('off')
        $name.parentElement.classList.remove('off')

        $name.focus()
      } else {
        $check.parentElement.classList.add('off')
        $name.parentElement.classList.add('off')
      }

    }

    function resetForms(event) {
      isForm = this.parentElement.nodeName

      if (isForm == 'FORM') {
        $form = this.parentElement

        for (key in $form.children) {
          if (key != 'namedItem' && key != 'item' && key != 'length') {
            $element = $form[key]

            if ($element.getAttribute('data-ui') != null)
              if ($element.parentElement.nodeName == 'LABEL')
                $element.parentElement.classList.add('off')
          }
        }
      }
    }

    function addRegister(event) {
      event.preventDefault()

      dataTmp = new FormData(this)
      data = {}

      dataTmp.append('creation_date', new Date())

      dataTmp.forEach(function(value, key) {
        data[key] = value
      })

      console.log(data)
      this.reset()
    }

    function today() {
      date  = new Date()

      _day   = date.getDate()
      _month = date.getMonth() + 1
      _year  = date.getFullYear()

      if (_month < 10) _month = "0" + _month
      if (_day < 10) _day = "0" + _day

      _today = _year + "-" + _month + "-" + _day
      
      return _today
    }

    $datePurchase.value = today()

    $formRegister.onsubmit = addRegister
    
    $$selects.forEach(function(select) {
      select.onchange = changeSelect
    })
    
    $$resets.forEach(function(element) {
      element.onclick = resetForms
    })
    
    $$tags.forEach(function(element) {
      isLabel = element.parentElement

      if (isLabel.nodeName == 'LABEL')
        isLabel.classList.add('off')
    })
  </script>
</body>
</html>